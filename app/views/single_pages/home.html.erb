<div class="row">
	<div class="col-xs-12">
		<div class="jumbotron">
		  <h1>Movie Search</h1>
		  <p>The easiest movie search app this side of the Mississippi</p>
			<div class="row">
				<div class="col-xs-6">
					<input id="search-box" type="text" class="form-control" placeholder="Search" autofocus>
					<div class="alert alert-dismissable alert-danger no-margin margin-top display-none" id="error-alert">
					  <button type="button" class="close" data-dismiss="alert">Ã—</button>
					  <strong class="block">This is why we can't have nice things!</strong>Error message: <span id="error-message"></span>
					</div>
				</div>
				<div class="col-xs-2">
					<button type="button" class="btn btn-primary" id="search-btn" data-loading-text='Searching <i class="fa fa-spinner fa-spin"></i>'>
					  Search
					</button>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="row display-none" id="results">
	<div class="col-sm-2">
		<img id="poster" />
		<p class="text-center small"><a id="imdbID">View on imdb</a></p>
	</div>
	<div class="col-sm-8">
		<div class="panel panel-primary">
		  <div class="panel-heading">
		    <h3 class="panel-title strong" id="title-year-rating"></h3>
		  </div>
		  <div class="panel-body">
				<p id="plot"></p>
				<div class="row">
					<div class="col-xs-12">
						<table class="table no-margin table-margin">
							<tbody>
								<tr>
									<td>Awards:</td>
									<td id="awards"></td>
								</tr>
								<tr>
									<td>Ratings:</td>
									<td>
										<img id="metacritic-mini-logo" src="http://www.gameinformer.com/cfs-filesystemfile.ashx/__key/CommunityServer-Components-ImageFileViewer/CommunityServer-Components-UserFiles-00-00-58-31-12-Attached+Files/4011.BigLogo_5F00_jpg.png_2D00_610x0.png"> : <span id="mc-rating"></span> 
										<span class="bar">|</span>
										<img id="imdb-mini-logo" src="http://upload.wikimedia.org/wikipedia/commons/thumb/3/35/IMDb_logo.svg/300px-IMDb_logo.svg.png"> : <span id="imdbRating"></span> out of <span id="imdbVotes"></span> votes
									</td>
								</tr>
								<tr>
									<td>Breakdown:</td>
									<td>
										<span id="genre"></span> <span class="bar">|</span> 
										<span id="runtime"></span> <span class="bar">|</span> 
										<span id="language"></span> <span class="bar">|</span> 
										<span id="country"></span>
									</td>
								</tr>
								<tr>
									<td>Featuring:</td>
									<td id="actors"></td>
								</tr>
								<tr>
									<td>Director(s):</td>
									<td id="director"></td>
								</tr>
								<tr>
									<td>Writer(s):</td>
									<td id="writer"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
		  </div>
		</div>
	</div>
</div>

<script type="text/javascript">
$(document)
	.ready(function() {
		$('#search-btn').click(function() {
			searchForMovie();
		});
	})
	.keypress(function(e) {
    if(e.which == 13) {
      searchForMovie();
    }
	})
;

function searchForMovie() {
	$('#search-box').focus();
	var btn = $('#search-btn')
	btn.button('loading');
	$.get("http://www.omdbapi.com/?t=" + $('#search-box').val()).done(function(data) {
    setTimeout(function() {
    	btn.button('reset')
    }, 500);
    $('#results, #error-alert').hide();
		window.parsed = JSON.parse(data);
		if (parsed.Response == "True") {
			loadResults(parsed);
			$('#results').show();
		} else {
			setErrorMessage(parsed.Error);
			$('#error-alert').show();
		}
	})
}

function loadResults(parsed) {
	$('#title-year-rating').text(parsed.Title + " (" + parsed.Year + ") [" + parsed.Rated + "]");
	$('#poster').attr('src', parsed.Poster);
	$('#imdbID').attr('href', "http://www.imdb.com/title/" + parsed.imdbID);
	$('#plot').text(parsed.Plot);
	$('#awards').text(parsed.Awards);
	$('#mc-rating').text(parsed.Metascore);
	$('#imdbRating').text(parsed.imdbRating);
	$('#imdbVotes').text(parsed.imdbVotes);
	$('#genre').text(parsed.Genre);
	$('#runtime').text(parsed.Runtime);
	$('#language').text(parsed.Language);
	$('#country').text(parsed.Country);
	$('#actors').text(parsed.Actors);
	$('#director').text(parsed.Director);
	$('#writer').text(parsed.Writer);
}

function setErrorMessage(message) {
	var imdbNoTextMessage = "Object reference not set to an instance of an object."
	if (message = imdbNoTextMessage) {
		message = "Forgetting something? :)"
	}
	$('#error-message').text(message);
}
</script>
